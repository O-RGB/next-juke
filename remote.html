<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
    />
    <title>NextCast Remote</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <link rel="stylesheet" href="css/style.css" />
  </head>
  <body
    class="flex flex-col h-screen overflow-hidden font-sans bg-black selection:bg-red-500 selection:text-white"
  >
    <div
      id="connection-overlay"
      class="fixed inset-0 z-[100] bg-zinc-900 flex flex-col items-center justify-center p-6 text-center transition-opacity duration-300"
    >
      <div class="relative w-20 h-20 mb-6">
        <div
          class="absolute inset-0 border-4 border-zinc-700 rounded-full"
        ></div>
        <div
          class="absolute inset-0 border-4 border-red-500 rounded-full border-t-transparent animate-spin"
        ></div>
        <i
          class="fa-solid fa-wifi absolute inset-0 flex items-center justify-center text-zinc-500 text-xl animate-pulse"
        ></i>
      </div>
      <h2 class="text-xl font-bold text-white mb-2">กำลังเชื่อมต่อ...</h2>
      <p id="conn-status-text" class="text-zinc-400 text-sm">
        กำลังค้นหาห้องปาร์ตี้
      </p>
    </div>

    <div
      id="toast"
      class="fixed top-20 left-1/2 -translate-x-1/2 z-50 bg-zinc-800 border border-zinc-700 text-white px-4 py-2 rounded-full shadow-xl transition-opacity duration-300 opacity-0 pointer-events-none text-sm font-bold flex items-center gap-2 whitespace-nowrap pt-safe"
    >
      <i class="fa-solid fa-check text-green-500"></i
      ><span id="toast-msg">Success</span>
    </div>

    <div
      id="login-screen"
      class="fixed inset-0 z-50 bg-black flex flex-col items-center justify-center p-6 hidden"
    >
      <div
        class="w-full max-w-sm c-glass p-8 rounded-3xl text-center space-y-6"
      >
        <h1 class="text-2xl font-bold text-white">เข้าร่วมปาร์ตี้</h1>
        <input
          id="username-input"
          type="text"
          placeholder="ใส่ชื่อของคุณ"
          class="w-full bg-zinc-900 border border-zinc-700 p-4 rounded-xl text-center text-white outline-none focus:border-red-600 transition-colors"
        />
        <button
          onclick="handleJoin()"
          class="w-full c-btn c-btn-primary p-4 rounded-xl shadow-lg shadow-red-600/20 active:scale-95"
        >
          เข้าห้อง
        </button>
      </div>
    </div>

    <div
      id="remote-ui"
      class="flex-1 flex flex-col hidden max-w-md mx-auto w-full bg-black h-full relative shadow-2xl"
    >
      <div
        class="shrink-0 p-4 pt-safe flex justify-between items-center c-glass border-b-0 border-white/5 bg-zinc-900/50"
      >
        <div class="flex items-center gap-3">
          <div
            id="user-avatar"
            class="w-10 h-10 rounded-full bg-zinc-800 flex items-center justify-center font-bold text-lg border border-white/10 text-gray-400"
          >
            ?
          </div>
          <div>
            <div
              id="user-name"
              class="font-bold text-sm leading-tight text-white"
            >
              -
            </div>
            <div
              id="user-role"
              class="text-[10px] text-gray-500 font-mono uppercase"
            >
              ผู้ร่วมงาน
            </div>
          </div>
        </div>
        <div
          id="status-badge"
          class="text-[10px] px-2 py-1 rounded-full border bg-zinc-800 border-zinc-700 text-gray-400"
        >
          Connecting...
        </div>
      </div>

      <div class="flex-1 overflow-y-auto p-5 pb-32 space-y-8 custom-scrollbar">
        <section>
          <div class="flex items-center gap-2 mb-2 px-1">
            <i class="fa-solid fa-magnifying-glass text-red-500 text-xs"></i>
            <h3
              class="text-xs font-bold text-zinc-500 uppercase tracking-wider"
            >
              Search
            </h3>
          </div>
          <div
            onclick="searchLib.open()"
            class="w-full bg-zinc-900 border border-zinc-700 rounded-xl px-4 py-3 flex items-center gap-3 cursor-pointer hover:border-red-500 hover:bg-zinc-800 transition-all group shadow-sm active:scale-[0.99]"
          >
            <i
              class="fa-solid fa-search text-zinc-500 group-hover:text-red-500 transition-colors"
            ></i>
            <span
              class="text-zinc-400 text-sm group-hover:text-white transition-colors"
              >ค้นหาเพลงใหม่...</span
            >
            <div
              class="ml-auto bg-zinc-800 rounded px-2 py-0.5 text-[10px] text-zinc-500 border border-zinc-700"
            >
              Invidious API
            </div>
          </div>
        </section>

        <section>
          <div class="flex items-center gap-2 mb-2 px-1">
            <i class="fa-brands fa-youtube text-red-500 text-xs"></i>
            <h3
              class="text-xs font-bold text-zinc-500 uppercase tracking-wider"
            >
              Paste Link
            </h3>
          </div>
          <div class="c-glass p-1 rounded-2xl">
            <div class="flex gap-2 p-1">
              <button
                onclick="pasteFromClipboard()"
                class="w-10 h-10 shrink-0 flex items-center justify-center rounded-xl bg-zinc-800 border border-zinc-700 text-white hover:bg-zinc-700 active:scale-95 transition-transform"
              >
                <i class="fa-solid fa-paste"></i>
              </button>
              <input
                id="url-input"
                type="text"
                placeholder="วางลิงก์ YouTube..."
                class="flex-1 min-w-0 bg-transparent px-2 text-sm text-white placeholder-zinc-600 outline-none"
              />
              <button
                onclick="addSong()"
                id="add-btn"
                class="w-10 h-10 shrink-0 flex items-center justify-center rounded-xl bg-zinc-800 border border-zinc-700 text-gray-500 transition-colors"
                disabled
              >
                <i class="fa-solid fa-plus"></i>
              </button>
            </div>

            <div
              id="preview-box"
              class="hidden mt-2 mx-1 mb-1 p-2 bg-zinc-900/80 rounded-xl border border-white/5 flex gap-3 items-center fade-in"
            >
              <img
                id="prev-img"
                src=""
                class="w-12 h-9 object-cover rounded bg-zinc-800"
              />
              <div class="flex-1 min-w-0">
                <p
                  id="prev-title"
                  class="text-xs font-bold truncate text-white"
                ></p>
                <p class="text-[10px] text-gray-500">Ready to add</p>
              </div>
            </div>

            <div id="dj-add-options" class="hidden px-2 pb-2 flex justify-end">
              <label
                class="flex items-center gap-2 text-xs text-gray-400 cursor-pointer select-none hover:text-white transition-colors"
              >
                <input
                  type="checkbox"
                  id="chk-play-next"
                  class="w-3 h-3 rounded border-zinc-600 text-red-600 focus:ring-red-500 bg-zinc-800/50"
                />
                <span>แทรกคิว (Play Next)</span>
              </label>
            </div>
          </div>
        </section>

        <section id="master-controls" class="hidden fade-in">
          <div class="flex items-center gap-2 mb-2 px-1 justify-between">
            <div class="flex items-center gap-2">
              <i class="fa-solid fa-sliders text-red-500 text-xs"></i>
              <h3
                class="text-xs font-bold text-zinc-500 uppercase tracking-wider"
              >
                Controller
              </h3>
            </div>
            <div id="fx-btn-container" class="flex gap-2">
              <button
                id="btn-open-fx"
                onclick="checkFxAvailability(() => openModal('fx-modal'))"
                class="text-[10px] font-bold bg-zinc-800 px-2 py-1 rounded text-pink-500 border border-zinc-700 hover:bg-zinc-700"
              >
                FX
              </button>
              <button
                id="btn-open-eq"
                onclick="checkFxAvailability(() => openModal('eq-modal'))"
                class="text-[10px] font-bold bg-zinc-800 px-2 py-1 rounded text-green-500 border border-zinc-700 hover:bg-zinc-700"
              >
                EQ
              </button>
            </div>
          </div>

          <div
            class="bg-zinc-900/50 border border-white/5 rounded-3xl p-4 shadow-xl backdrop-blur-sm"
          >
            <div class="flex items-center justify-between px-2">
              <button
                onclick="sendAction('SEEK', {amount: -5})"
                class="w-10 h-10 rounded-full flex items-center justify-center text-zinc-400 hover:text-white hover:bg-white/5 transition active:scale-95"
              >
                <i class="fa-solid fa-rotate-left text-sm"></i>
              </button>

              <div class="flex items-center gap-4">
                <button
                  id="btn-toggle-play"
                  onclick="sendTogglePlay()"
                  class="w-16 h-16 rounded-full bg-red-600 flex items-center justify-center text-white shadow-lg shadow-red-600/30 active:scale-95 transition hover:bg-red-500"
                >
                  <i
                    id="icon-toggle-play"
                    class="fa-solid fa-play text-2xl pl-1"
                  ></i>
                </button>
                <button
                  id="btn-next"
                  onclick="sendAction('NEXT')"
                  class="w-12 h-12 rounded-full bg-zinc-800 flex items-center justify-center text-zinc-400 border border-zinc-700 shadow active:scale-95 transition hover:text-red-500"
                >
                  <i class="fa-solid fa-forward-step text-lg"></i>
                </button>
              </div>

              <button
                onclick="sendAction('SEEK', {amount: 5})"
                class="w-10 h-10 rounded-full flex items-center justify-center text-zinc-400 hover:text-white hover:bg-white/5 transition active:scale-95"
              >
                <i class="fa-solid fa-rotate-right text-sm"></i>
              </button>
            </div>
          </div>
        </section>

        <div
          id="non-master-msg"
          class="hidden flex flex-col items-center justify-center text-zinc-600 border-2 border-dashed border-zinc-800 rounded-2xl p-6 min-h-[120px]"
        >
          <i class="fa-solid fa-lock mb-2 text-xl"></i>
          <p class="text-sm font-bold">Controller Locked</p>
          <p class="text-xs">รอ DJ ควบคุมเพลง</p>
        </div>
      </div>

      <div
        class="fixed bottom-0 left-0 w-full p-4 pb-safe z-20 pointer-events-none"
      >
        <div class="max-w-md mx-auto w-full pointer-events-auto">
          <button
            onclick="openModal('queue-modal')"
            class="w-full bg-zinc-900/90 backdrop-blur-md border border-zinc-700 text-white p-4 rounded-2xl shadow-2xl flex items-center justify-between active:scale-[0.99] transition-transform"
          >
            <div class="flex items-center gap-3">
              <div
                class="w-10 h-10 rounded-full bg-zinc-800 flex items-center justify-center text-red-500"
              >
                <i class="fa-solid fa-music"></i>
              </div>
              <div class="text-left">
                <div class="font-bold text-sm">รายการคิวเพลง</div>
                <div class="text-[10px] text-gray-400">
                  คลิกเพื่อดูรายการ (<span id="q-count-btn">0</span>)
                </div>
              </div>
            </div>
            <i class="fa-solid fa-chevron-up text-zinc-500"></i>
          </button>
        </div>
      </div>
    </div>

    <div id="alert-modal" class="c-modal-backdrop hidden">
      <div class="c-modal-content" style="max-width: 400px; min-height: 200px">
        <div class="c-modal-header border-b-0 pb-0">
          <h3 id="alert-title" class="text-xl font-bold text-white">Alert</h3>
        </div>
        <div class="c-modal-body text-center pt-2 pb-2">
          <div id="alert-icon" class="text-5xl mb-4 text-yellow-500"></div>
          <p id="alert-msg" class="text-gray-300 text-sm leading-relaxed"></p>
        </div>
        <div class="c-modal-footer pb-4 pt-2 border-t-0 bg-transparent">
          <button
            onclick="closeModal('alert-modal')"
            class="w-full c-btn c-btn-primary rounded-xl"
          >
            OK
          </button>
        </div>
      </div>
    </div>

    <div id="queue-modal" class="c-modal-backdrop hidden">
      <div class="c-modal-content c-modal-fixed">
        <div class="c-modal-header">
          <h3 class="font-bold text-white">รายการคิวเพลง</h3>
          <button
            onclick="closeModal('queue-modal')"
            class="c-btn c-btn-ghost p-2 rounded-full"
          >
            <i class="fa-solid fa-times"></i>
          </button>
        </div>
        <div id="queue-list-modal" class="c-modal-body space-y-2 p-4"></div>
      </div>
    </div>

    <div id="fx-modal" class="c-modal-backdrop hidden">
      <div class="c-modal-content" style="min-height: 350px">
        <div class="c-modal-header">
          <h3 class="text-xl font-bold text-white">
            <i class="fas fa-sliders-h mr-2 text-pink-500"></i>Master FX
          </h3>
          <button
            onclick="closeModal('fx-modal')"
            class="c-btn c-btn-ghost p-2 rounded-full"
          >
            <i class="fas fa-times text-xl"></i>
          </button>
        </div>
        <div class="c-modal-body space-y-6">
          <div>
            <div
              class="text-sm mb-3 text-zinc-400 text-center uppercase tracking-wider font-bold"
            >
              Pitch Shift
            </div>
            <div
              class="flex items-center justify-between bg-zinc-950 p-2 rounded-xl border border-zinc-800"
            >
              <button
                onclick="changePitch(-1)"
                class="w-12 h-12 flex items-center justify-center bg-zinc-800 hover:bg-zinc-700 rounded-lg text-white active:scale-90 transition-transform"
              >
                <i class="fas fa-caret-left text-2xl"></i>
              </button>
              <div class="text-center w-20">
                <span
                  id="pitch-val-text"
                  class="text-3xl font-mono text-pink-500 font-bold"
                  >0</span
                >
              </div>
              <button
                onclick="changePitch(1)"
                class="w-12 h-12 flex items-center justify-center bg-zinc-800 hover:bg-zinc-700 rounded-lg text-white active:scale-90 transition-transform"
              >
                <i class="fas fa-caret-right text-2xl"></i>
              </button>
            </div>
          </div>
          <div>
            <div class="flex justify-between text-sm mb-2">
              <span class="text-zinc-400">Reverb</span
              ><span id="reverb-val-text" class="font-mono text-pink-400"
                >0%</span
              >
            </div>
            <div class="c-range-wrapper">
              <input
                type="range"
                id="fx-reverb"
                min="0"
                max="2"
                step="0.1"
                value="0"
                oninput="setFx('reverb', this.value)"
              />
            </div>
          </div>
        </div>
        <div class="c-modal-footer grid grid-cols-2 gap-3">
          <button onclick="resetFx()" class="c-btn c-btn-secondary">
            Reset
          </button>
          <button
            onclick="closeModal('fx-modal')"
            class="c-btn c-btn-primary bg-white text-black hover:bg-gray-200"
          >
            Done
          </button>
        </div>
      </div>
    </div>

    <div id="eq-modal" class="c-modal-backdrop hidden">
      <div class="c-modal-content" style="max-width: 500px; min-height: 350px">
        <div class="c-modal-header">
          <h3 class="text-xl font-bold text-white">
            <i class="fas fa-chart-bar mr-2 text-green-500"></i>Equalizer
          </h3>
          <button
            onclick="closeModal('eq-modal')"
            class="c-btn c-btn-ghost p-2 rounded-full"
          >
            <i class="fas fa-times text-xl"></i>
          </button>
        </div>
        <div class="c-modal-body">
          <div
            class="flex justify-between gap-0 overflow-x-auto pb-4 no-scrollbar"
          >
            <script>
              const bands = [
                "60",
                "170",
                "310",
                "600",
                "1k",
                "3k",
                "6k",
                "12k",
                "14k",
                "16k",
              ];
              document.write(
                bands
                  .map(
                    (label, i) => `
                        <div class="flex flex-col items-center gap-2 flex-1 min-w-[30px]">
                            <div class="eq-slider-wrapper">
                                <input type="range" min="-12" max="12" step="1" value="0" oninput="setEq(${i}, this.value)" class="eq-slider-input">
                            </div>
                            <span class="text-[9px] text-zinc-500 font-mono -mt-2">${label}</span>
                        </div>
                    `
                  )
                  .join("")
              );
            </script>
          </div>
        </div>
        <div class="c-modal-footer grid grid-cols-2 gap-3">
          <button onclick="resetEq()" class="c-btn c-btn-secondary">
            Flat
          </button>
          <button
            onclick="closeModal('eq-modal')"
            class="c-btn c-btn-primary bg-white text-black hover:bg-gray-200"
          >
            Done
          </button>
        </div>
      </div>
    </div>

    <div id="search-modal" class="c-modal-backdrop hidden">
      <div
        class="c-modal-content c-modal-fixed bg-zinc-900 max-w-md mx-auto w-full flex flex-col min-h-[60vh]"
      >
        <div
          class="c-modal-header p-4 gap-2 border-b border-zinc-800 bg-zinc-900 shrink-0 z-30 relative"
        >
          <div class="relative flex-1 group">
            <i
              class="fa-solid fa-magnifying-glass absolute left-3 top-1/2 -translate-y-1/2 text-zinc-500"
            ></i>
            <input
              id="inv-search-input"
              type="text"
              placeholder="ค้นหาเพลง YouTube..."
              class="w-full bg-zinc-800 border border-zinc-700 rounded-xl pl-10 pr-4 py-3 text-white focus:border-red-500 outline-none transition-colors"
              autocomplete="off"
            />
            <div
              id="search-suggestions"
              class="absolute top-full left-0 right-0 mt-2 bg-zinc-800 border border-zinc-700 rounded-xl shadow-2xl overflow-hidden hidden z-50 max-h-60 overflow-y-auto custom-scrollbar"
            ></div>
          </div>

          <button
            id="btn-trigger-search"
            class="w-12 h-12 flex items-center justify-center bg-zinc-800 hover:bg-red-600 border border-zinc-700 hover:border-red-500 rounded-xl transition-colors shrink-0 text-white"
          >
            <i class="fa-solid fa-magnifying-glass"></i>
          </button>

          <button
            onclick="closeModal('search-modal')"
            class="c-btn c-btn-ghost w-10 h-10 rounded-full flex items-center justify-center p-0"
          >
            <i class="fa-solid fa-times text-lg"></i>
          </button>
        </div>

        <div
          class="c-modal-body bg-black/50 p-4 space-y-3 custom-scrollbar relative z-10 flex-1"
        >
          <div
            id="search-placeholder"
            class="absolute inset-0 flex flex-col items-center justify-center text-zinc-600 space-y-4 opacity-60 pointer-events-none"
          >
            <i class="fa-brands fa-youtube text-6xl"></i>
            <p class="text-sm">พิมพ์ชื่อเพลงเพื่อค้นหา</p>
          </div>

          <div
            id="search-loader"
            class="hidden absolute inset-0 flex items-center justify-center z-20 bg-black/50 backdrop-blur-sm"
          >
            <div class="flex flex-col items-center gap-2">
              <i
                class="fa-solid fa-circle-notch fa-spin text-red-500 text-3xl"
              ></i>
              <span class="text-xs text-zinc-500">Searching...</span>
            </div>
          </div>

          <div id="search-list" class="space-y-3 pb-safe"></div>
        </div>
      </div>
    </div>

    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/youtube-search.js"></script>
    <script src="js/remote.js"></script>
  </body>
</html>