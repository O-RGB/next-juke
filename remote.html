<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
    />
    <title>NextCast Remote</title>
    <meta
      name="description"
      content="NextCast คือเว็บแอปพลิเคชันฟรีที่เปลี่ยนสมาร์ททีวี คอมพิวเตอร์ หรือแท็บเล็ต ให้เป็นตู้เพลง Jukebox ที่ทุกคนในปาร์ตี้สามารถสแกน QR Code เพื่อช่วยกันเลือกเพลงผ่านมือถือได้ทันที ไม่ต้องโหลดแอป"
    />
    <meta
      name="keywords"
      content="NextCast, Jukebox, Party, Karaoke, YouTube Player, WebRTC, สั่งเพลงผ่านมือถือ, คาราโอเกะ, ฟังเพลงกลุ่ม, เว็บเปิดเพลงปาร์ตี้"
    />
    <meta name="author" content="NextCast" />

    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://next-cast.vercel.app/" />
    <meta property="og:title" content="NextCast - Party Jukebox" />
    <meta
      property="og:description"
      content="สร้างห้องปาร์ตี้ แชร์ QR Code แล้วให้เพื่อนช่วยกันเลือกเพลงผ่านมือถือ ใช้งานฟรี!"
    />
    <meta
      property="og:image"
      content="https://next-cast.vercel.app/assets/cover.png"
    />
    <meta property="twitter:card" content="summary_large_image" />

    <link rel="manifest" href="/assets/manifest.json" />
    <link rel="apple-touch-icon" href="/assets/icon.png" />
    <link rel="icon" type="image/png" href="/assets/icon-t.png" />

    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://www.youtube.com/iframe_api"></script>

    <link rel="stylesheet" href="css/style.css" />
  </head>
  <body
    class="flex flex-col h-screen overflow-hidden font-sans bg-black selection:bg-red-500 selection:text-white"
  >
    <div
      id="connection-overlay"
      class="fixed inset-0 z-[100] bg-zinc-900 flex flex-col items-center justify-center p-6 text-center transition-opacity duration-300"
    >
      <div class="relative w-20 h-20 mb-6">
        <div
          class="absolute inset-0 border-4 border-zinc-700 rounded-full"
        ></div>
        <div
          class="absolute inset-0 border-4 border-red-500 rounded-full border-t-transparent animate-spin"
        ></div>
        <i
          class="fa-solid fa-wifi absolute inset-0 flex items-center justify-center text-zinc-500 text-xl animate-pulse"
        ></i>
      </div>
      <h2 class="text-xl font-bold text-white mb-2">กำลังเชื่อมต่อ...</h2>
      <p id="conn-status-text" class="text-zinc-400 text-sm">
        กำลังค้นหาห้องปาร์ตี้
      </p>
    </div>

    <div
      id="toast"
      class="fixed top-20 left-1/2 -translate-x-1/2 z-50 bg-zinc-800 border border-zinc-700 text-white px-4 py-2 rounded-full shadow-xl transition-opacity duration-300 opacity-0 pointer-events-none text-sm font-bold flex items-center gap-2 whitespace-nowrap pt-safe"
    >
      <i class="fa-solid fa-check text-green-500"></i
      ><span id="toast-msg">Success</span>
    </div>

    <div
      id="login-screen"
      class="fixed inset-0 z-50 bg-black flex flex-col items-center justify-center p-6 hidden"
    >
      <div
        class="w-full max-w-sm c-glass p-8 rounded-3xl text-center space-y-6 animate-[fadeIn_0.5s]"
      >
        <div
          class="w-20 h-20 bg-gradient-to-tr from-red-600 to-orange-500 rounded-full mx-auto flex items-center justify-center shadow-lg shadow-red-500/20 mb-2"
        >
          <i class="fa-solid fa-music text-3xl text-white"></i>
        </div>
        <h1 class="text-2xl font-bold text-white">เข้าร่วมปาร์ตี้</h1>
        <div class="space-y-4">
          <input
            id="username-input"
            type="text"
            placeholder="ใส่ชื่อของคุณ"
            class="c-input text-center text-lg"
          />
          <button
            onclick="handleJoin()"
            class="w-full bg-red-600 hover:bg-red-500 text-white font-bold py-4 rounded-xl shadow-lg active:scale-[0.98] transition-all"
          >
            เข้าห้อง
          </button>
        </div>
      </div>
    </div>

    <div
      id="remote-ui"
      class="flex-1 flex flex-col hidden max-w-md mx-auto w-full bg-black h-full relative shadow-2xl"
    >
      <div
        class="shrink-0 p-4 pt-safe flex justify-between items-center c-glass border-b-0 border-white/5 bg-zinc-900/50"
      >
        <div class="flex items-center gap-3">
          <div
            id="user-avatar"
            class="w-10 h-10 rounded-full bg-zinc-800 flex items-center justify-center font-bold text-lg border border-white/10 text-gray-400"
          >
            ?
          </div>
          <div>
            <div
              id="user-name"
              class="font-bold text-sm leading-tight text-white"
            >
              -
            </div>
            <div
              id="user-role"
              class="text-[10px] text-gray-500 font-mono uppercase"
            >
              ผู้ร่วมงาน
            </div>
          </div>
        </div>
        <div
          id="status-badge"
          class="text-[10px] px-2 py-1 rounded-full border bg-zinc-800 border-zinc-700 text-gray-400"
        >
          Connecting...
        </div>
      </div>

      <div class="flex-1 overflow-y-auto p-5 pb-32 space-y-8 custom-scrollbar">
        <section>
          <div
            onclick="searchLib.open()"
            class="w-full bg-zinc-900 border border-zinc-700 rounded-xl px-4 py-3 flex items-center gap-3 cursor-pointer hover:border-red-500 hover:bg-zinc-800 transition-all group shadow-sm active:scale-[0.99]"
          >
            <i
              class="fa-solid fa-search text-zinc-500 group-hover:text-red-500 transition-colors"
            ></i
            ><span
              class="text-zinc-400 text-sm group-hover:text-white transition-colors"
              >ค้นหาเพลงใหม่...</span
            >
          </div>
        </section>

        <section>
          <div class="c-glass p-1 rounded-2xl shadow-lg">
            <div class="flex gap-2 p-1">
              <button
                onclick="pasteFromClipboard()"
                class="c-btn c-btn-secondary w-10 h-10 p-0 rounded-xl"
              >
                <i class="fa-solid fa-paste"></i>
              </button>
              <input
                id="url-input"
                type="text"
                placeholder="วางลิงก์ YouTube..."
                class="flex-1 min-w-0 bg-transparent px-2 text-sm text-white placeholder-zinc-600 outline-none"
              />
              <button
                onclick="addSong()"
                id="add-btn"
                class="c-btn c-btn-secondary w-10 h-10 p-0 rounded-xl"
                disabled
              >
                <i class="fa-solid fa-plus"></i>
              </button>
            </div>
            <div
              id="preview-box"
              class="hidden mt-2 mx-1 mb-1 p-2 bg-zinc-900/80 rounded-xl border border-white/5 flex gap-3 items-center animate-[fadeIn_0.2s]"
            >
              <img
                id="prev-img"
                src=""
                class="w-12 h-9 object-cover rounded bg-zinc-800"
              />
              <div class="flex-1 min-w-0">
                <p
                  id="prev-title"
                  class="text-xs font-bold truncate text-white"
                ></p>
              </div>
            </div>
            <div
              id="dj-add-options"
              class="hidden px-2 pb-2 flex justify-end border-t border-white/5 mt-2 pt-2"
            >
              <label
                class="flex items-center gap-2 text-xs text-gray-400 cursor-pointer select-none"
                ><input
                  type="checkbox"
                  id="chk-play-next"
                  class="w-3 h-3 rounded border-zinc-600 text-red-600 bg-zinc-800/50"
                /><span>แทรกคิว (Play Next)</span></label
              >
            </div>
          </div>
        </section>

        <section id="master-controls" class="hidden fade-in space-y-3">
          <div class="flex items-center gap-2 mb-2 px-1 justify-between">
            <h3
              class="text-xs font-bold text-zinc-500 uppercase tracking-wider"
            >
              Controller
            </h3>
            <div id="fx-btn-container" class="flex gap-2">
              <button
                id="btn-open-fx"
                onclick="checkFxAvailability(() => openModal('fx-modal'))"
                class="text-[10px] font-bold bg-zinc-800 px-2 py-1 rounded text-pink-500 border border-zinc-700 hover:bg-zinc-700 transition-colors"
              >
                FX
              </button>
              <button
                id="btn-open-eq"
                onclick="checkFxAvailability(() => openModal('eq-modal'))"
                class="text-[10px] font-bold bg-zinc-800 px-2 py-1 rounded text-green-500 border border-zinc-700 hover:bg-zinc-700 transition-colors"
              >
                EQ
              </button>
            </div>
          </div>
          <div
            class="bg-zinc-900/50 border border-white/5 rounded-3xl p-4 shadow-xl"
          >
            <div class="flex items-center justify-between px-2">
              <button
                onclick="sendAction('SEEK', {amount: -5})"
                class="c-btn c-btn-ghost c-btn-icon"
              >
                <i class="fa-solid fa-rotate-left"></i>
              </button>
              <div class="flex items-center gap-4">
                <button
                  id="btn-toggle-play"
                  onclick="sendTogglePlay()"
                  class="w-16 h-16 bg-red-600 hover:bg-red-500 rounded-full flex items-center justify-center text-white shadow-lg shadow-red-600/30 active:scale-95 transition-all"
                >
                  <i
                    id="icon-toggle-play"
                    class="fa-solid fa-play text-2xl pl-1"
                  ></i>
                </button>
                <button
                  id="btn-next"
                  onclick="sendAction('NEXT')"
                  class="w-12 h-12 bg-zinc-800 hover:bg-zinc-700 border border-zinc-700 rounded-full flex items-center justify-center text-white shadow-md active:scale-95 transition-all"
                >
                  <i class="fa-solid fa-forward-step text-lg"></i>
                </button>
              </div>
              <button
                onclick="sendAction('SEEK', {amount: 5})"
                class="c-btn c-btn-ghost c-btn-icon"
              >
                <i class="fa-solid fa-rotate-right"></i>
              </button>
            </div>
          </div>
        </section>

        <div id="non-master-msg" class="text-center py-10 opacity-50 hidden">
          <i class="fa-solid fa-headphones text-4xl mb-2 text-zinc-700"></i>
          <p class="text-xs text-zinc-500">รอคิวเพลงของคุณ...</p>
        </div>
      </div>

      <div
        class="fixed bottom-0 left-0 w-full p-4 pb-safe z-20 pointer-events-none"
      >
        <div class="max-w-md mx-auto w-full pointer-events-auto">
          <button
            onclick="openModal('queue-modal')"
            class="w-full bg-zinc-900/90 border border-zinc-700 text-white p-4 rounded-2xl shadow-2xl flex items-center justify-between active:scale-[0.99] transition-transform group hover:bg-zinc-800"
          >
            <div class="flex items-center gap-3">
              <div
                class="w-10 h-10 rounded-full bg-zinc-800 flex items-center justify-center text-red-500 group-hover:bg-zinc-700 transition-colors"
              >
                <i class="fa-solid fa-music"></i>
              </div>
              <div class="text-left">
                <div class="font-bold text-sm">รายการคิวเพลง</div>
                <div class="text-[10px] text-gray-400">
                  คลิกเพื่อดูรายการ (<span id="q-count-btn">0</span>)
                </div>
              </div>
            </div>
            <i
              class="fa-solid fa-chevron-up text-zinc-500 group-hover:text-white transition-colors"
            ></i>
          </button>
        </div>
      </div>
    </div>

    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/youtube-search.js"></script>

    <script src="js/components.js"></script>
    <script src="js/ui-core.js"></script>
    <script>
      // 2. Inject Modals (Separated)
      renderComponents(
        COMP_SEARCH_MODAL,
        COMP_ALERT_MODAL,
        COMP_QUEUE_MODAL,
        COMP_FX_MODAL,
        COMP_EQ_MODAL
      );

      // EQ Sliders Logic (ต้องรันหลังจาก renderComponents แล้ว)
      document.addEventListener("DOMContentLoaded", () => {
        const container = document.getElementById("eq-sliders-container");
        if (container && container.innerHTML.trim() === "") {
          const bands = [
            "60",
            "170",
            "310",
            "600",
            "1k",
            "3k",
            "6k",
            "12k",
            "14k",
            "16k",
          ];
          container.innerHTML = bands
            .map(
              (label, i) => `
                <div class="flex flex-col items-center gap-2 flex-1 min-w-[30px]">
                    <div class="eq-slider-wrapper">
                        <input type="range" min="-12" max="12" step="1" value="0" oninput="setEq(${i}, this.value)" class="eq-slider-input c-slider -rotate-90 w-24">
                    </div>
                    <span class="text-[9px] text-zinc-500 font-mono -mt-2">${label}</span>
                </div>
            `
            )
            .join("");
        }
      });
    </script>

    <script src="js/remote.js"></script>
  </body>
</html>
