<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
    />

    <title>NextJuke - Party Jukebox ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ó‡∏∏‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏π‡πâ‡πÄ‡∏û‡∏•‡∏á</title>
    <meta
      name="description"
      content="‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ó‡∏µ‡∏ß‡∏µ ‡∏Ñ‡∏≠‡∏° ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏≠‡πÅ‡∏û‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô Party Jukebox ‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡∏Å‡∏±‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏û‡∏•‡∏á‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏≠‡∏õ ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ü‡∏£‡∏µ!"
    />
    <meta
      name="keywords"
      content="Jukebox, Party, Karaoke, YouTube Player, WebRTC, PeerJS, ‡∏õ‡∏≤‡∏£‡πå‡∏ï‡∏µ‡πâ, ‡πÄ‡∏û‡∏•‡∏á, ‡∏Ñ‡∏≤‡∏£‡∏≤‡πÇ‡∏≠‡πÄ‡∏Å‡∏∞"
    />
    <meta name="author" content="NextJuke" />

    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://nextjuke.vercel.app/" />
    <meta property="og:title" content="NextJuke - Party Jukebox" />
    <meta
      property="og:description"
      content="‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏≤‡∏£‡πå‡∏ï‡∏µ‡πâ ‡πÅ‡∏ä‡∏£‡πå QR Code ‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡∏Å‡∏±‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏û‡∏•‡∏á‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ü‡∏£‡∏µ‡∏ï‡∏•‡∏≠‡∏î‡∏ä‡∏µ‡∏û!"
    />
    <meta
      property="og:image"
      content="https://img.youtube.com/vi/dQw4w9WgXcQ/maxresdefault.jpg"
    />

    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content="https://nextjuke.vercel.app/" />
    <meta property="twitter:title" content="NextJuke - Party Jukebox" />
    <meta
      property="twitter:description"
      content="‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ó‡∏∏‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÄ‡∏õ‡πá‡∏ô Party Jukebox ‡∏ü‡∏£‡∏µ!"
    />
    <meta
      property="twitter:image"
      content="https://img.youtube.com/vi/dQw4w9WgXcQ/maxresdefault.jpg"
    />

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta name="apple-mobile-web-app-title" content="NextJuke" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="theme-color" content="#000000" />

    <link
      rel="manifest"
      href="data:application/json;base64,eyJuYW1lIjoiTmV4dEp1a2UgLSBQYXJ0eSBKdWtlYm94Iiwic2hvcnRfbmFtZSI6Ik5leHRKdWtlIiwiZGVzY3JpcHRpb24iOiJQYXJ0eSBKdWtlYm94IFBvd2VyZWQgYnkgWW91VHViZSIsImRpc3BsYXkiOiJzdGFuZGFsb25lIiwiYmFja2dyb3VuZF9jb2xvciI6IiMwMDAwMDAiLCJ0aGVtZV9jb2xvciI6IiMwMDAwMDAiLCJzdGFydF91cmwiOiIvIiwiaWNvbnMiOlt7InNyYyI6Imh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC90d2JzL2ljb25zQG1haW4vaWNvbnMvbXVzaWMtbm90ZS1iZWFtZWQuc3ZnIiwidHlwZSI6ImltYWdlL3N2Zyt4bWwiLCJzaXplcyI6IjUxMng1MTIifV19"
    />
    <link
      rel="apple-touch-icon"
      href="https://cdn-icons-png.flaticon.com/512/727/727218.png"
    />
    <link
      rel="icon"
      type="image/png"
      href="https://cdn-icons-png.flaticon.com/512/727/727218.png"
    />

    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://www.youtube.com/iframe_api"></script>

    <style>
      body {
        overflow: hidden;
        background: #000;
        user-select: none;
        -webkit-tap-highlight-color: transparent;
      }
      .scrollbar-hide::-webkit-scrollbar {
        display: none;
      }
      input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        height: 16px;
        width: 16px;
        border-radius: 50%;
        background: #ffffff;
        cursor: pointer;
        margin-top: -6px;
        opacity: 0;
        transition: opacity 0.2s;
      }
      input[type="range"]:hover::-webkit-slider-thumb {
        opacity: 1;
      }
      .fade-transition {
        transition: opacity 0.5s ease-in-out;
      }
      .opacity-0-force {
        opacity: 0 !important;
        pointer-events: none !important;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .animate-in {
        animation: fadeIn 0.7s ease-out forwards;
      }
      /* Custom Scrollbar for Modal content */
      .modal-scroll::-webkit-scrollbar {
        width: 4px;
      }
      .modal-scroll::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.05);
      }
      .modal-scroll::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.2);
        border-radius: 4px;
      }
    </style>
  </head>
  <body
    class="bg-black text-white font-sans h-screen w-screen relative overflow-hidden selection:bg-pink-500 selection:text-white"
  >
    <div
      id="landing-view"
      class="absolute inset-0 z-[100] bg-black flex flex-col font-sans overflow-y-auto transition-opacity duration-700 scrollbar-hide"
    >
      <nav
        class="p-6 flex justify-between items-center max-w-7xl mx-auto w-full shrink-0"
      >
        <div
          class="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-pink-500 to-orange-500"
        >
          NextJuke
        </div>
        <button
          onclick="startApp()"
          class="bg-white text-black px-6 py-2 rounded-full font-bold hover:scale-105 transition"
        >
          ‡πÄ‡∏õ‡∏¥‡∏î Player
        </button>
      </nav>

      <main
        class="flex-1 flex flex-col items-center justify-center text-center p-6 space-y-8 max-w-4xl mx-auto animate-in w-full pb-20"
      >
        <div class="space-y-4">
          <h1
            class="text-5xl sm:text-7xl font-extrabold tracking-tight leading-tight"
          >
            ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ó‡∏∏‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ <br />
            ‡πÄ‡∏õ‡πá‡∏ô
            <span
              class="text-transparent bg-clip-text bg-gradient-to-r from-pink-500 to-orange-500"
            >
              Party Jukebox.
            </span>
          </h1>
          <p class="text-xl text-gray-400 max-w-2xl mx-auto">
            ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏≤‡∏£‡πå‡∏ï‡∏µ‡πâ ‡πÅ‡∏ä‡∏£‡πå QR Code ‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡πÜ
            ‡∏ä‡πà‡∏ß‡∏¢‡∏Å‡∏±‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏û‡∏•‡∏á‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏≠‡∏õ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô
          </p>
        </div>

        <button
          onclick="startApp()"
          class="group relative inline-flex items-center justify-center gap-3 bg-pink-600 hover:bg-pink-500 text-white px-8 py-4 rounded-full text-xl font-bold transition-all hover:shadow-[0_0_40px_rgba(236,72,153,0.6)]"
        >
          <i class="fa-solid fa-rocket"></i> ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏õ‡∏≤‡∏£‡πå‡∏ï‡∏µ‡πâ‡πÄ‡∏•‡∏¢
          <span
            class="absolute inset-0 rounded-full ring-2 ring-white/20 group-hover:ring-white/40 animate-pulse"
          ></span>
        </button>

        <div
          class="grid grid-cols-1 sm:grid-cols-3 gap-6 w-full text-left mt-16"
        >
          <div
            class="p-6 bg-zinc-900/50 border border-zinc-800 rounded-2xl hover:bg-zinc-900 transition hover:border-zinc-700"
          >
            <div class="text-3xl mb-4 text-red-500">
              <i class="fa-brands fa-youtube"></i>
            </div>
            <h3 class="text-xl font-bold mb-2">YouTube Powered</h3>
            <p class="text-gray-400 leading-relaxed text-sm">
              ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏û‡∏•‡∏á‡∏à‡∏≤‡∏Å YouTube ‡πÑ‡∏î‡πâ‡∏ô‡∏±‡∏ö‡∏•‡πâ‡∏≤‡∏ô‡πÄ‡∏û‡∏•‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
            </p>
          </div>
          <div
            class="p-6 bg-zinc-900/50 border border-zinc-800 rounded-2xl hover:bg-zinc-900 transition hover:border-zinc-700"
          >
            <div class="text-3xl mb-4 text-blue-500">
              <i class="fa-solid fa-qrcode"></i>
            </div>
            <h3 class="text-xl font-bold mb-2">‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢</h3>
            <p class="text-gray-400 leading-relaxed text-sm">
              ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏™‡πÅ‡∏Å‡∏ô QR Code ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å
            </p>
          </div>
          <div
            class="p-6 bg-zinc-900/50 border border-zinc-800 rounded-2xl hover:bg-zinc-900 transition hover:border-zinc-700"
          >
            <div class="text-3xl mb-4 text-purple-500">
              <i class="fa-solid fa-users"></i>
            </div>
            <h3 class="text-xl font-bold mb-2">‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏¥‡∏ß‡πÄ‡∏û‡∏•‡∏á</h3>
            <p class="text-gray-400 leading-relaxed text-sm">
              ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏û‡∏•‡∏á ‡πÇ‡∏î‡∏¢‡∏°‡∏µ Master DJ ‡∏Ñ‡∏≠‡∏¢‡∏î‡∏π‡πÅ‡∏•‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢
            </p>
          </div>
        </div>

        <div class="w-full mt-16 pt-10 border-t border-zinc-800 text-left">
          <h3 class="text-2xl font-bold mb-6 text-center">
            ‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á NextJuke
          </h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <div class="space-y-4">
              <h4 class="text-lg font-bold text-pink-500">
                ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏≠‡∏∞‡πÑ‡∏£?
              </h4>
              <p class="text-gray-400 text-sm leading-relaxed">
                ‡πÄ‡∏ß‡πá‡∏ö‡πÅ‡∏≠‡∏õ‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡πÄ‡∏ß‡πá‡∏ö‡∏™‡∏°‡∏±‡∏¢‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏•‡∏∑‡πà‡∏ô‡πÑ‡∏´‡∏•‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÅ‡∏≠‡∏õ
                Native:
              </p>
              <ul class="text-sm text-gray-400 list-disc list-inside space-y-1">
                <li>
                  <strong class="text-white">PeerJS (WebRTC):</strong> ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
                  Real-time ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏£‡∏µ‡πÇ‡∏°‡∏ó‡πÅ‡∏•‡∏∞‡∏à‡∏≠‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏û‡∏•‡∏á
                </li>
                <li>
                  <strong class="text-white">YouTube IFrame API:</strong>
                  ‡∏Ç‡∏∏‡∏°‡∏û‡∏•‡∏±‡∏á‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏û‡∏•‡∏á
                </li>
                <li>
                  <strong class="text-white">Tailwind CSS:</strong>
                  ‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏≤‡πÉ‡∏´‡πâ‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏° ‡∏ó‡∏±‡∏ô‡∏™‡∏°‡∏±‡∏¢
                </li>
              </ul>
            </div>
            <div class="space-y-4">
              <h4 class="text-lg font-bold text-green-500">‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ü‡∏£‡∏µ 100%</h4>
              <p class="text-gray-400 text-sm leading-relaxed">
                NextJuke ‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡πÉ‡∏à‡∏£‡∏±‡∏Å‡πÉ‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏î‡∏ô‡∏ï‡∏£‡∏µ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏õ‡∏≤‡∏£‡πå‡∏ï‡∏µ‡πâ
                <br /><br />
                <span
                  class="text-white bg-white/10 px-2 py-1 rounded inline-block mb-2"
                >
                  <i class="fa-solid fa-ban text-red-500"></i> ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢
                </span>
                <span
                  class="text-white bg-white/10 px-2 py-1 rounded inline-block"
                >
                  <i class="fa-solid fa-ban text-red-500"></i> ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏á‡∏¥‡∏ô
                </span>
              </p>
            </div>
          </div>
        </div>

        <div class="w-full mt-10 mb-6 p-1">
          <div
            class="relative overflow-hidden rounded-3xl bg-gradient-to-br from-indigo-900 to-purple-900 border border-white/10 p-8 sm:p-12 text-left flex flex-col sm:flex-row items-center justify-between gap-8 group shadow-2xl"
          >
            <div
              class="absolute top-0 right-0 w-64 h-64 bg-purple-500/20 rounded-full blur-3xl -mr-16 -mt-16 pointer-events-none"
            ></div>
            <div class="space-y-4 relative z-10 max-w-xl">
              <div
                class="flex items-center gap-3 text-indigo-300 font-bold uppercase tracking-wider text-sm"
              >
                <i class="fa-solid fa-music"></i> ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏ö‡πâ‡∏≤‡∏ô
              </div>
              <h2 class="text-3xl sm:text-4xl font-bold text-white">
                NextKaraoke
              </h2>
              <p class="text-gray-300 text-lg leading-relaxed">
                ‡∏≠‡∏µ‡∏Å‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏≤‡∏¢‡∏£‡πâ‡∏≠‡∏á! ‡πÅ‡∏≠‡∏õ‡πÄ‡∏•‡πà‡∏ô‡∏Ñ‡∏≤‡∏£‡∏≤‡πÇ‡∏≠‡πÄ‡∏Å‡∏∞‡∏ö‡∏ô‡πÄ‡∏ß‡πá‡∏ö ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå
                MIDI, EMK, NCN
              </p>
            </div>
            <a
              href="https://next-karaoke.vercel.app/"
              target="_blank"
              class="relative z-10 shrink-0 bg-white text-indigo-900 px-8 py-4 rounded-full font-bold text-lg flex items-center gap-2 hover:bg-indigo-50 hover:scale-105 transition shadow-xl"
            >
              ‡∏•‡∏≠‡∏á‡∏î‡∏π‡πÑ‡∏´‡∏° <i class="fa-solid fa-arrow-right"></i>
            </a>
          </div>
        </div>
      </main>

      <footer class="p-6 text-center text-zinc-700 text-xs shrink-0">
        NextJuke ¬© 2025 - Free for everyone
      </footer>
    </div>

    <div
      id="player-view"
      class="absolute inset-0 z-0 hidden opacity-0 transition-opacity duration-1000"
    >
      <div
        id="welcome-modal"
        class="fixed inset-0 z-[110] bg-black/90 backdrop-blur-sm hidden flex items-center justify-center p-4 fade-transition"
      >
        <div
          class="w-full max-w-2xl bg-zinc-900 border border-white/10 rounded-2xl shadow-2xl flex flex-col max-h-[85vh] overflow-hidden animate-[fadeIn_0.5s]"
        >
          <div
            class="p-4 border-b border-white/10 flex justify-between items-center bg-black/40 shrink-0"
          >
            <h3 class="font-bold text-lg md:text-xl text-white">
              ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà NextJuke
            </h3>
            <button
              onclick="handleCloseWelcome()"
              class="text-gray-400 hover:text-white px-2 py-1"
            >
              <i class="fa-solid fa-times text-lg"></i>
            </button>
          </div>

          <div
            class="p-4 md:p-6 overflow-y-auto flex-1 modal-scroll text-white"
          >
            <div class="grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-8">
              <div
                class="bg-zinc-800/50 p-3 md:p-6 rounded-2xl border border-green-500/20 text-center space-y-2 md:space-y-4"
              >
                <i
                  class="fa-brands fa-android text-4xl md:text-6xl text-green-500 mx-auto block"
                ></i>
                <h3 class="text-base md:text-xl font-bold text-green-400">
                  Android User
                </h3>
                <p class="text-xs md:text-sm text-gray-300 leading-relaxed">
                  ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏û‡∏•‡∏á‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ <br />
                  ‡πÅ‡∏ï‡∏∞ <strong>"‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á"</strong> ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏à‡∏ö
                </p>
                <div
                  class="flex justify-center items-center gap-2 bg-green-900/20 py-1.5 md:py-2 rounded-lg"
                >
                  <i class="fa-solid fa-check text-green-500 text-xs"></i>
                  <span class="text-[10px] md:text-xs text-green-500"
                    >‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡∏¥‡∏î‡∏à‡∏≠‡∏ó‡∏¥‡πâ‡∏á‡πÑ‡∏ß‡πâ</span
                  >
                </div>
              </div>

              <div
                class="bg-zinc-800/50 p-3 md:p-6 rounded-2xl border border-white/20 text-center space-y-2 md:space-y-4"
              >
                <i
                  class="fa-brands fa-apple text-4xl md:text-6xl text-white mx-auto block"
                ></i>
                <h3 class="text-base md:text-xl font-bold text-white">
                  iOS User
                </h3>
                <p class="text-xs md:text-sm text-gray-300 leading-relaxed">
                  ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ iOS <br />
                  <strong class="text-pink-400"
                    >‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á" ‡∏´‡∏≤‡∏Å‡πÄ‡∏û‡∏•‡∏á‡πÄ‡∏á‡∏µ‡∏¢‡∏ö</strong
                  >
                </p>
                <div
                  class="inline-block bg-red-500/10 text-red-300 text-[10px] md:text-xs px-2 md:px-3 py-1 rounded-full border border-red-500/20"
                >
                  ‡∏Ç‡πâ‡∏≠‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£
                </div>
              </div>
            </div>
          </div>

          <div class="p-4 border-t border-white/5 bg-zinc-900 shrink-0">
            <button
              onclick="handleCloseWelcome()"
              class="w-full bg-pink-600 hover:bg-pink-500 text-white py-3 md:py-4 rounded-xl font-bold text-base md:text-lg transition shadow-lg shadow-pink-600/20 active:scale-95"
            >
              ‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö
            </button>
          </div>
        </div>
      </div>

      <div
        id="toast-container"
        class="fixed top-20 right-5 z-[100] flex flex-col gap-2 pointer-events-none"
      ></div>

      <div
        id="interaction-overlay"
        class="absolute inset-0 z-[60] flex items-center justify-center bg-black/80 hidden fade-transition"
      >
        <div
          onclick="handleUserInteraction()"
          class="bg-zinc-900 p-8 rounded-2xl border border-zinc-700 flex flex-col items-center cursor-pointer hover:bg-zinc-800 transition"
        >
          <i class="fa-solid fa-volume-high text-3xl mb-4 text-pink-500"></i>
          <h3 class="text-lg font-bold">‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á</h3>
        </div>
      </div>

      <header
        id="main-header"
        class="fixed top-0 left-0 right-0 z-50 flex items-center justify-between px-6 h-20 bg-gradient-to-b from-black/90 to-transparent fade-transition"
      >
        <div class="flex items-center gap-3">
          <div
            class="w-8 h-8 bg-zinc-800 rounded flex items-center justify-center border border-zinc-700"
          >
            <i
              id="spin-icon"
              class="fa-solid fa-compact-disc text-white/50"
            ></i>
          </div>
          <h1
            class="font-bold text-lg tracking-wider text-white/80 hidden md:block"
          >
            NextJuke
          </h1>
        </div>
        <div
          class="flex items-center gap-2 px-3 py-1 rounded-full bg-zinc-900/80 border border-zinc-700 text-xs font-mono text-gray-400"
        >
          <span id="status-dot" class="w-2 h-2 rounded-full bg-red-500"></span>
          <span id="status-text">OFFLINE</span>
        </div>
      </header>

      <div
        class="absolute inset-0 w-full h-full bg-black overflow-hidden flex items-center justify-center"
      >
        <div
          id="video-wrapper"
          class="relative w-full h-full flex items-center justify-center transition-all duration-500"
        >
          <div
            id="youtube-player"
            class="w-full h-full pointer-events-none"
          ></div>
        </div>
        <div
          id="buffering-indicator"
          class="absolute inset-0 z-10 flex items-center justify-center bg-black hidden"
        >
          <i class="fa-solid fa-spinner text-white text-3xl animate-spin"></i>
        </div>
        <div
          id="countdown-overlay"
          class="absolute inset-0 z-40 bg-black flex items-center justify-center hidden fade-transition"
        >
          <div class="text-center z-10 space-y-4">
            <div
              id="cd-number"
              class="text-[120px] font-bold text-white leading-none"
            >
              3
            </div>
            <div class="space-y-2 px-4">
              <p class="text-gray-500 uppercase tracking-widest text-xs">
                Up Next
              </p>
              <h2
                id="cd-title"
                class="text-xl font-bold text-white max-w-2xl mx-auto line-clamp-2"
              >
                Song Title
              </h2>
              <div class="text-sm text-pink-500 font-bold">
                <i class="fa-solid fa-user-astronaut"></i>
                <span id="cd-sender">User</span>
              </div>
            </div>
          </div>
          <img
            id="cd-bg"
            src=""
            class="absolute inset-0 w-full h-full object-cover opacity-30 blur-2xl grayscale"
          />
        </div>
        <div
          id="qr-screen"
          class="absolute inset-0 z-20 flex flex-col items-center justify-center bg-black transition-opacity duration-500"
        >
          <div
            class="flex flex-col items-center gap-6 p-8 rounded-3xl bg-zinc-900 border border-zinc-800 shadow-2xl max-w-sm w-full"
          >
            <h2 class="text-2xl font-bold text-center">Join Party</h2>
            <div class="p-3 bg-white rounded-xl"><div id="qrcode"></div></div>
            <div
              class="bg-black/50 px-4 py-2 rounded-lg border border-zinc-800 flex gap-2 items-center w-full overflow-hidden"
            >
              <i class="fa-solid fa-link text-zinc-500 shrink-0"></i>
              <span
                id="join-url"
                class="text-xs font-mono text-gray-400 truncate"
                >Generating Link...</span
              >
            </div>
            <p class="text-zinc-500 text-xs">‡∏™‡πÅ‡∏Å‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏•‡∏á</p>
          </div>
        </div>
        <div
          id="now-playing-overlay"
          class="absolute bottom-24 left-1/2 -translate-x-1/2 z-30 pointer-events-none opacity-0 transition-opacity duration-500 w-full max-w-md px-4"
        >
          <div
            class="bg-black/80 backdrop-blur p-4 rounded-xl border border-white/10 flex items-center gap-4 shadow-2xl"
          >
            <img
              id="np-thumb"
              src=""
              class="w-12 h-12 rounded bg-zinc-800 object-cover"
            />
            <div class="min-w-0 flex-1">
              <h2 id="np-title" class="text-sm font-bold text-white truncate">
                Title
              </h2>
              <div class="text-xs text-gray-400 truncate">
                Requested by
                <span id="np-sender" class="text-pink-500">User</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <footer
        id="main-footer"
        class="fixed bottom-0 left-0 right-0 z-50 bg-gradient-to-t from-black/95 to-transparent h-24 flex items-end pb-6 px-6 gap-4 fade-transition"
      >
        <div class="flex items-center gap-2 shrink-0">
          <button
            onclick="togglePlay()"
            class="text-white hover:text-pink-500 p-2 bg-white/10 rounded-full w-10 h-10 flex items-center justify-center transition-colors"
          >
            <i id="play-btn-icon" class="fa-solid fa-play ml-0.5"></i>
          </button>
          <button
            onclick="triggerNext()"
            class="text-gray-400 hover:text-white p-2 transition-colors"
          >
            <i class="fa-solid fa-forward-step"></i>
          </button>
        </div>
        <div class="flex-1 flex items-center gap-4 mb-3.5">
          <span
            id="time-curr"
            class="text-[10px] font-mono text-gray-500 w-8 text-right"
            >0:00</span
          >
          <div
            class="flex-1 h-1 bg-zinc-800 rounded-full relative group cursor-pointer"
          >
            <div
              id="prog-bar"
              class="absolute inset-y-0 left-0 bg-pink-600 rounded-full"
              style="width: 0%"
            ></div>
            <input
              type="range"
              id="seek-slider"
              min="0"
              max="100"
              value="0"
              step="0.1"
              class="absolute inset-0 w-full h-full opacity-0 cursor-pointer"
              oninput="handleSeek(this.value)"
            />
          </div>
          <span id="time-dur" class="text-[10px] font-mono text-gray-500 w-8"
            >0:00</span
          >
        </div>
        <div
          class="flex items-center gap-2 border-l border-zinc-800 pl-4 shrink-0 mb-1"
        >
          <button
            id="btn-fullscreen"
            onclick="toggleFullscreen()"
            class="text-gray-400 hover:text-white p-2 hidden"
          >
            <i class="fa-solid fa-expand"></i>
          </button>
          <button
            onclick="openModal('settings-modal')"
            class="text-gray-400 hover:text-white p-2"
          >
            <i class="fa-solid fa-cog"></i>
          </button>
        </div>
      </footer>

      <div
        id="settings-modal"
        class="fixed inset-0 z-[80] bg-black/90 hidden flex items-center justify-center p-4 fade-transition"
      >
        <div
          class="bg-zinc-900 border border-zinc-800 w-full max-w-2xl rounded-2xl overflow-hidden shadow-2xl flex flex-col max-h-[80vh]"
        >
          <div
            class="p-4 border-b border-zinc-800 flex justify-between items-center bg-zinc-900"
          >
            <h3 class="font-bold text-white">Menu</h3>
            <button
              onclick="closeModal('settings-modal')"
              class="text-gray-400 hover:text-white px-2"
            >
              <i class="fa-solid fa-times"></i>
            </button>
          </div>
          <div class="flex border-b border-zinc-800 bg-black/20">
            <button
              onclick="switchTab('dashboard')"
              id="tab-dashboard"
              class="flex-1 py-3 text-sm font-bold border-b-2 border-pink-500 text-white"
            >
              Dashboard
            </button>
            <button
              onclick="switchTab('settings')"
              id="tab-settings"
              class="flex-1 py-3 text-sm font-bold border-b-2 border-transparent text-gray-500"
            >
              Settings
            </button>
          </div>
          <div class="p-6 overflow-y-auto flex-1 bg-black/20">
            <div
              id="view-dashboard"
              class="grid grid-cols-1 md:grid-cols-2 gap-4"
            >
              <div
                class="bg-zinc-800/30 rounded-xl p-4 h-64 flex flex-col border border-white/5"
              >
                <h3
                  class="font-bold text-pink-500 mb-2 text-xs uppercase tracking-wider"
                >
                  Queue (<span id="queue-count">0</span>)
                </h3>
                <div
                  id="queue-list"
                  class="overflow-y-auto flex-1 space-y-1 custom-scrollbar"
                ></div>
              </div>
              <div
                class="bg-zinc-800/30 rounded-xl p-4 h-64 flex flex-col border border-white/5"
              >
                <h3
                  class="font-bold text-blue-500 mb-2 text-xs uppercase tracking-wider"
                >
                  Users (<span id="user-count">0</span>)
                </h3>
                <div
                  id="user-list"
                  class="overflow-y-auto flex-1 space-y-1 custom-scrollbar"
                ></div>
              </div>
            </div>
            <div id="view-settings" class="hidden space-y-6">
              <div class="flex items-center justify-between">
                <div>
                  <h4 class="font-bold text-sm">Safe Mode (iOS)</h4>
                  <p class="text-xs text-zinc-500">
                    ‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
                  </p>
                </div>
                <button
                  onclick="toggleSetting('reqInt')"
                  id="btn-reqInt"
                  class="w-10 h-6 rounded-full bg-zinc-700 relative transition-colors"
                >
                  <div
                    class="absolute left-1 top-1 w-4 h-4 bg-white rounded-full transition-transform"
                  ></div>
                </button>
              </div>
              <div class="flex items-center justify-between">
                <div>
                  <h4 class="font-bold text-sm">Crop to Fill</h4>
                  <p class="text-xs text-zinc-500">
                    ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠ (‡∏ï‡∏±‡∏î‡∏Ç‡∏≠‡∏ö)
                  </p>
                </div>
                <button
                  onclick="toggleSetting('fit')"
                  id="btn-fit"
                  class="w-10 h-6 rounded-full bg-zinc-700 relative transition-colors"
                >
                  <div
                    class="absolute left-1 top-1 w-4 h-4 bg-white rounded-full transition-transform"
                  ></div>
                </button>
              </div>
              <div class="flex items-center justify-between">
                <div><h4 class="font-bold text-sm">Video Quality</h4></div>
                <select
                  onchange="updateQuality(this.value)"
                  id="sel-quality"
                  class="bg-zinc-800 border border-zinc-700 rounded px-2 py-1 text-xs text-white outline-none"
                >
                  <option value="auto">Auto</option>
                  <option value="hd720">HD</option>
                  <option value="medium">Medium</option>
                  <option value="small">Low (Save Data)</option>
                </select>
              </div>
              <div class="pt-4 border-t border-zinc-800 text-center">
                <button
                  onclick="openModal('welcome-modal')"
                  class="text-xs text-pink-500 hover:underline"
                >
                  ‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      const peerConfig = {
        config: { iceServers: [{ urls: "stun:stun.l.google.com:19302" }] },
      };
      let player, peer, peerId;
      let connections = [];
      let isAppStarted = false;

      let state = {
        queue: [],
        currentSong: null,
        users: [],
        masterId: localStorage.getItem("nj_master_id") || null,
        settings: {
          reqInt: localStorage.getItem("nj_reqInt") !== "false",
          fit: localStorage.getItem("nj_fit") === "true",
          quality: localStorage.getItem("nj_quality") || "auto",
        },
      };

      let isPlaying = false;
      let isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
      let hasInteracted = false;
      let lastPlayedSongId = null;
      let idleTimer;

      function startApp() {
        isAppStarted = true;
        document
          .getElementById("landing-view")
          .classList.add("opacity-0", "pointer-events-none");

        setTimeout(() => {
          document.getElementById("landing-view").style.display = "none";
          document.getElementById("player-view").classList.remove("hidden");
          setTimeout(
            () =>
              document
                .getElementById("player-view")
                .classList.remove("opacity-0"),
            100
          );

          document.getElementById("welcome-modal").classList.remove("hidden");
        }, 700);

        initPlayer();
        initPeer();
        updateSettingsUI();
        checkFullscreenSupport();

        document.addEventListener("mousemove", resetIdle);
        document.addEventListener("touchstart", resetIdle);
        document.addEventListener("click", resetIdle);
        resetIdle();
      }

      function handleCloseWelcome() {
        document.getElementById("welcome-modal").classList.add("hidden");
      }

      function checkFullscreenSupport() {
        if (document.fullscreenEnabled || document.webkitFullscreenEnabled) {
          document.getElementById("btn-fullscreen").classList.remove("hidden");
        }
      }

      function initPeer() {
        peer = new Peer(peerConfig);
        peer.on("open", (id) => {
          peerId = id;
          document.getElementById("status-text").innerText = "ONLINE";
          document
            .getElementById("status-text")
            .classList.replace("text-gray-400", "text-green-500");
          document
            .getElementById("status-dot")
            .classList.replace("bg-red-500", "bg-green-500");

          const url = `${window.location.origin}/remote.html?host=${id}`;
          document.getElementById("join-url").innerText = url;
          new QRCode(document.getElementById("qrcode"), {
            text: url,
            width: 180,
            height: 180,
            colorDark: "#000000",
            colorLight: "#ffffff",
            correctLevel: QRCode.CorrectLevel.L,
          });
        });
        peer.on("connection", (conn) => {
          conn.on("open", () => {
            connections.push(conn);
            broadcastState();
          });
          conn.on("data", (data) => handleCommand(data, conn));
          conn.on(
            "close",
            () => (connections = connections.filter((c) => c !== conn))
          );
        });
      }

      function initPlayer() {
        if (window.YT && window.YT.Player) {
          createPlayer();
        } else {
          window.onYouTubeIframeAPIReady = () => createPlayer();
        }
      }

      function createPlayer() {
        if (player) return;
        player = new YT.Player("youtube-player", {
          height: "100%",
          width: "100%",
          playerVars: {
            autoplay: 1,
            controls: 0,
            disablekb: 1,
            fs: 0,
            iv_load_policy: 3,
            modestbranding: 1,
            rel: 0,
            playsinline: 1,
            vq: "small",
          },
          events: {
            onReady: onPlayerReady,
            onStateChange: onPlayerStateChange,
          },
        });
      }

      function onPlayerReady(event) {
        if (state.settings.quality !== "auto")
          event.target.setPlaybackQuality(state.settings.quality);
        event.target.mute();
      }

      function onPlayerStateChange(event) {
        if (event.data === 1) {
          // PLAYING
          isPlaying = true;
          document.getElementById("spin-icon").classList.add("text-pink-500");
          document
            .getElementById("play-btn-icon")
            .classList.replace("fa-play", "fa-pause");
          document
            .getElementById("buffering-indicator")
            .classList.add("hidden");
          document
            .getElementById("qr-screen")
            .classList.add("opacity-0", "pointer-events-none");

          if (state.currentSong && state.currentSong.id !== lastPlayedSongId) {
            lastPlayedSongId = state.currentSong.id;
            showNowPlaying();
          }
          checkAudioContext();
        } else if (event.data === 2) {
          // PAUSED
          isPlaying = false;
          document
            .getElementById("spin-icon")
            .classList.remove("text-pink-500");
          document
            .getElementById("play-btn-icon")
            .classList.replace("fa-pause", "fa-play");
        } else if (event.data === 3) {
          // BUFFERING
          document
            .getElementById("buffering-indicator")
            .classList.remove("hidden");
        } else if (event.data === 0) {
          // ENDED
          triggerNext();
        }
      }

      function showNowPlaying() {
        const np = document.getElementById("now-playing-overlay");
        np.classList.remove("opacity-0");
        setTimeout(() => np.classList.add("opacity-0"), 5000);
      }

      function checkAudioContext() {
        if (!state.settings.reqInt) {
          hideInteraction();
          player.unMute();
          return;
        }
        const isMuted = player.isMuted();
        if (isIOS) {
          if (isMuted) showInteraction();
          else hideInteraction();
        } else {
          if (!hasInteracted && isMuted) showInteraction();
          else {
            hideInteraction();
            if (isMuted) player.unMute();
          }
        }
      }

      function showInteraction() {
        document
          .getElementById("interaction-overlay")
          .classList.remove("hidden");
      }
      function hideInteraction() {
        document.getElementById("interaction-overlay").classList.add("hidden");
      }
      function handleUserInteraction() {
        hasInteracted = true;
        if (player) {
          player.unMute();
          player.setVolume(100);
          player.playVideo();
        }
        hideInteraction();
      }

      function handleCommand(cmd, conn) {
        switch (cmd.type) {
          case "JOIN":
            const u = cmd.user;
            if (state.masterId === u.id || !state.masterId) {
              u.isMaster = true;
              state.masterId = u.id;
              localStorage.setItem("nj_master_id", u.id);
            }
            if (!state.users.find((x) => x.id === u.id)) {
              state.users.push(u);
              showToast(`${u.name} joined!`, "info");
            }
            renderDashboard();
            broadcastState();
            break;
          case "ADD_SONG":
            fetch(`https://noembed.com/embed?url=${cmd.url}`)
              .then((r) => r.json())
              .then((d) => {
                if (!d.title) return;
                const videoId = extractVideoID(cmd.url);
                const song = {
                  id: videoId,
                  title: d.title,
                  thumbnail:
                    d.thumbnail_url ||
                    `https://img.youtube.com/vi/${videoId}/mqdefault.jpg`,
                  sender: cmd.user.name,
                };
                state.queue.push(song);
                showToast(`Added: ${song.title}`, "success");
                renderDashboard();
                broadcastState();
                if (!state.currentSong && state.queue.length === 1)
                  triggerNext();
              });
            break;
          case "PLAY":
            if (isMaster(cmd.user.id)) player.playVideo();
            break;
          case "PAUSE":
            if (isMaster(cmd.user.id)) player.pauseVideo();
            break;
          case "NEXT":
            if (isMaster(cmd.user.id)) triggerNext();
            break;
          case "GET_STATE":
            broadcastState();
            break;
        }
      }

      function triggerNext() {
        if (state.queue.length > 0) {
          const song = state.queue.shift();

          const cdOverlay = document.getElementById("countdown-overlay");
          const cdNum = document.getElementById("cd-number");

          document.getElementById("cd-title").innerText = song.title;
          document.getElementById("cd-sender").innerText = song.sender;
          document.getElementById("cd-bg").src = song.thumbnail;

          cdOverlay.classList.remove("hidden");

          let count = 3;
          cdNum.innerText = count;

          const timer = setInterval(() => {
            count--;
            if (count > 0) {
              cdNum.innerText = count;
            } else {
              clearInterval(timer);
              cdOverlay.classList.add("hidden");
              playSong(song);
            }
          }, 1000);
        } else {
          state.currentSong = null;
          player.stopVideo();
          document
            .getElementById("qr-screen")
            .classList.remove("opacity-0", "pointer-events-none");
          broadcastState();
        }
      }

      function playSong(song) {
        state.currentSong = song;
        renderDashboard();

        document.getElementById("np-title").innerText = song.title;
        document.getElementById("np-thumb").src = song.thumbnail;
        document.getElementById("np-sender").innerText = song.sender;

        player.loadVideoById({
          videoId: song.id,
          suggestedQuality:
            state.settings.quality !== "auto"
              ? state.settings.quality
              : "large",
        });
        broadcastState();
      }

      function extractVideoID(url) {
        const m = url.match(
          /^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/
        );
        return m && m[7].length == 11 ? m[7] : false;
      }
      function isMaster(id) {
        return id === state.masterId;
      }
      function broadcastState() {
        const payload = {
          type: "UPDATE_STATE",
          queue: state.queue,
          users: state.users,
          masterId: state.masterId,
          currentId: state.currentSong ? state.currentSong.id : null,
        };
        connections.forEach((c) => {
          if (c.open) c.send(payload);
        });
      }
      function showToast(msg, type = "info") {
        const t = document.createElement("div");
        const color = type === "success" ? "text-green-400" : "text-blue-400";
        t.className = `bg-zinc-900 border border-zinc-700 text-white px-4 py-3 rounded-xl shadow-xl animate-[fadeIn_0.3s] text-sm font-bold flex items-center gap-2`;
        t.innerHTML = `<i class="fa-solid fa-${
          type === "success" ? "check" : "info-circle"
        } ${color}"></i> ${msg}`;
        document.getElementById("toast-container").appendChild(t);
        setTimeout(() => t.remove(), 3000);
      }

      function renderDashboard() {
        const qList = document.getElementById("queue-list");
        document.getElementById("queue-count").innerText = state.queue.length;
        if (state.queue.length === 0)
          qList.innerHTML =
            '<div class="text-zinc-600 text-xs italic text-center py-4">No songs in queue</div>';
        else {
          qList.innerHTML = state.queue
            .map(
              (s, i) => `
            <div class="flex justify-between items-center p-2 bg-zinc-800/30 rounded border border-white/5 text-xs">
                <span class="truncate flex-1 text-gray-300">${i + 1}. ${
                s.title
              }</span>
                <span class="text-[10px] text-gray-500 ml-2">${s.sender}</span>
            </div>`
            )
            .join("");
        }

        const uList = document.getElementById("user-list");
        document.getElementById("user-count").innerText = state.users.length;
        uList.innerHTML = state.users
          .map(
            (u) => `
            <div class="flex justify-between items-center p-2 bg-zinc-800/30 rounded border border-white/5 text-xs">
                <span class="${
                  u.id === state.masterId
                    ? "text-pink-500 font-bold"
                    : "text-gray-300"
                }">${u.name} ${u.id === state.masterId ? "üëë" : ""}</span>
                ${
                  u.id !== state.masterId
                    ? `<button onclick="promoteUser('${u.id}')" class="text-[10px] bg-zinc-700 px-2 py-0.5 rounded hover:bg-zinc-600 text-white">Make DJ</button>`
                    : ""
                }
            </div>`
          )
          .join("");
      }

      function promoteUser(id) {
        state.masterId = id;
        localStorage.setItem("nj_master_id", id);
        state.users.forEach((u) => (u.isMaster = u.id === id));
        renderDashboard();
        broadcastState();
        showToast("DJ Changed!", "info");
      }
      function togglePlay() {
        if (isPlaying) player.pauseVideo();
        else player.playVideo();
      }
      function handleSeek(val) {
        if (player) {
          const dur = player.getDuration();
          player.seekTo((val / 100) * dur, true);
        }
      }

      setInterval(() => {
        if (player && isPlaying) {
          const c = player.getCurrentTime();
          const d = player.getDuration();
          document.getElementById("time-curr").innerText = formatTime(c);
          document.getElementById("time-dur").innerText = formatTime(d);
          document.getElementById("prog-bar").style.width = `${(c / d) * 100}%`;
          document.getElementById("seek-slider").value = (c / d) * 100;
        }
      }, 1000);
      function formatTime(s) {
        if (!s) return "0:00";
        const m = Math.floor(s / 60);
        const sec = Math.floor(s % 60);
        return `${m}:${sec < 10 ? "0" : ""}${sec}`;
      }
      function openModal(id) {
        document.getElementById(id).classList.remove("hidden");
      }
      function closeModal(id) {
        document.getElementById(id).classList.add("hidden");
      }

      function switchTab(tab) {
        ["dashboard", "settings"].forEach((t) => {
          document.getElementById(`view-${t}`).classList.add("hidden");
          const tabBtn = document.getElementById(`tab-${t}`);
          tabBtn.classList.replace("border-pink-500", "border-transparent");
          tabBtn.classList.replace("text-white", "text-gray-500");
        });
        document.getElementById(`view-${tab}`).classList.remove("hidden");
        const activeBtn = document.getElementById(`tab-${tab}`);
        activeBtn.classList.replace("border-transparent", "border-pink-500");
        activeBtn.classList.replace("text-gray-500", "text-white");
      }

      function toggleSetting(key) {
        state.settings[key] = !state.settings[key];
        localStorage.setItem(`nj_${key}`, state.settings[key]);
        updateSettingsUI();
      }
      function updateQuality(val) {
        state.settings.quality = val;
        localStorage.setItem("nj_quality", val);
        if (player) player.setPlaybackQuality(val);
      }

      function updateSettingsUI() {
        const ri = state.settings.reqInt;
        const btnRi = document.getElementById("btn-reqInt");
        btnRi.className = `w-10 h-6 rounded-full relative transition-colors ${
          ri ? "bg-green-600" : "bg-zinc-700"
        }`;
        btnRi.firstElementChild.className = `absolute top-1 w-4 h-4 bg-white rounded-full shadow transition-transform ${
          ri ? "translate-x-5" : "translate-x-1"
        }`;

        const fit = state.settings.fit;
        const btnFit = document.getElementById("btn-fit");
        btnFit.className = `w-10 h-6 rounded-full relative transition-colors ${
          fit ? "bg-green-600" : "bg-zinc-700"
        }`;
        btnFit.firstElementChild.className = `absolute top-1 w-4 h-4 bg-white rounded-full shadow transition-transform ${
          fit ? "translate-x-5" : "translate-x-1"
        }`;

        const wrap = document.getElementById("video-wrapper");
        if (fit) {
          wrap.className =
            "absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[100vw] h-[56.25vw] min-h-[100vh] min-w-[177.78vh] pointer-events-none transition-all duration-500";
        } else {
          wrap.className =
            "relative w-full h-full flex items-center justify-center transition-all duration-500";
        }
        document.getElementById("sel-quality").value = state.settings.quality;
      }

      function toggleFullscreen() {
        if (!document.fullscreenElement)
          document.documentElement.requestFullscreen();
        else if (document.exitFullscreen) document.exitFullscreen();
      }

      function resetIdle() {
        const header = document.getElementById("main-header");
        const footer = document.getElementById("main-footer");
        header.classList.remove("opacity-0-force");
        footer.classList.remove("opacity-0-force");

        clearTimeout(idleTimer);
        idleTimer = setTimeout(() => {
          if (
            document
              .getElementById("settings-modal")
              .classList.contains("hidden") &&
            isAppStarted
          ) {
            header.classList.add("opacity-0-force");
            footer.classList.add("opacity-0-force");
          }
        }, 3000);
      }
    </script>
  </body>
</html>
